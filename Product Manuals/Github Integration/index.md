## Github Integration

ModelOp Center can use a Github repository as a storage backend for all the model assets. 

All assets are stored as plain text files in a single repository with a mandated directory structure detailed below.
Every change to an asset (via CLI or API) is immediately pushed to Github repository. The integration is bi-directional with external changes to the repository (via git client or Github web interface) propagated to Model Manage.

### Configuration

Setup the configuration to the repository in the `db` section of the `config.yaml` as shown below:
```yaml
db:
  type: git
  url: https://github.com/org/repo.git
  branch: master
  username: secret://git_user
  password: secret://git_pass
  commit_prefix: "this is added to the beginning of each commit message"
```

* `type: git` tells ModelOp Center to use Github as the storage backend.
* `url` points to the existing Github repository.
* `branch` tells which git branch to use.
* `username` is the Docker Secret storing the user name of a Github user with read/write access to repository.
* `password` is the Docker Secret storing the user password.
* `commit_prefix` is optional.  When present, its value is prepended to any commit messages for commits generated by ModelOp Center.


### Docker Secrets for Credentials

It is best practice to obscure passwords using Docker Secrets. These secrets are defined by adding the following section to end of the docker-compose.yml file: 

```
secrets:
  git_user:
    external: true
  git_pass:
    external: true
```

In addition, the secret must be injected by running the ['docker secret create'](https://docs.docker.com/engine/reference/commandline/secret_create/) command. This can be automated or handled within UCP.

For example: 

```
echo joe | docker secret create git_user -
echo password | docker secret create git_pass -
```

Note: Only HTTPS URLs to respositories are currently supported. 

### Repository directories structure

All ModelOp Center assets must be stored in the directory structure shown below:
```
attachments
models
schemas
sensors
streams
```

The integration between the system follows these rules: 
* Each asset must be stored as a separate file.
* File name is the asset name and file extension is an asset type.
* No assets of same kind can share the same name.
* Attachments are grouped into subdirectories named after model they belong to.

Example:
```
models\
  model1.py
  mymodel.R
attachments\
  model1\
    att1.zip
    mylib1.tgz
streams\
  input1.json
  out.json
```

Here, attachments in `attachments/model1` directory belong to model `model1.py`.

### Github webhooks
To make ModelOp Center aware of external changes to the repository you will need to set up a Github webhook.
To set up a webhook on GitHub, head over to the **Settings** page of your repository, and click on **Webhooks & Services**. After that, click on **Add Webhook**. Paste the publicly accessible URL of your ModelOp Center proxy instance into Payload URL:
```
https://<ModelOp Center_PROXY>/api/1/service/model-manage-1/1/git
```
